# Настройка языка
 d-i debian-installer/locale string ru_RU
 d-i debian-installer/locale select ru_RU.UTF-8
 d-i debian-installer/language string ru
 d-i debian-installer/country string RU
 d-i debian-installer/keymap string ru
# Выбор клавиатуры.
 d-i console-tools/archs select at
 d-i console-keymaps-at/keymap select ru
 d-i console-setup/toggle string Alt+Shift
 d-i console-setup/layoutcode string ru
 d-i keyboard-configuration/toggle select Alt+Shift
 d-i keyboard-configuration/layoutcode string ru
 d-i keyboard-configuration/xkb-keymap select ru
 d-i languagechooser/language-name-fb select Russian
 d-i countrychooser/country-name select Russia
# Настройка сетевого интерфейса
 d-i netcfg/choose_interface select auto
# Выбор компонент репозитория
 d-i apt-setup/non-free boolean true
 d-i apt-setup/contrib boolean true
# Имена хоста и домен
d-i netcfg/get_hostname string astra
d-i netcfg/get_domain string domain.local
d-i netcfg/get_hostname seen true
d-i apt-setup/services-select none
d-i apt-setup/security_host string
# Выключить показ надоедливого диалога с WEP ключом.
d-i netcfg/wireless_wep string
# Сетевой репозиторий для установки
 d-i mirror/protocol string http
 d-i mirror/country string manual
 d-i mirror/http/hostname string {{ hostvars[repo.srv].ansible_ssh_host }}:{{ repo.port }}
 d-i mirror/http/directory string /{{ repo.name_iso[0] }}/
d-i mirror/http/proxy string
# Настройка часов и синхронизации времени
# Здесь вы можете указать любое допустимое значение для $TZ
 d-i time/zone string {{ ntp.timezone }}
Определяет, нужно ли использовать NTP для установки часов во время установки
 d-i clock-setup/ntp boolean true
# Используемый сервер NTP. Значение по умолчанию указывается здесь
 d-i clock-setup/ntp-server {{ ntp.ntp_int }}
# Задаёт, установлены или нет аппаратные часы по Гринвичу.
 d-i clock-setup/utc boolean true
# Устанавливаемый пакет (мета) с образом ядра; можно указать "none", если ядро устанавливать не нужно.
d-i base-installer/kernel/image string linux-image-generic
# Пропустить создание обычной учётной записи пользователя.
 d-i passwd/make-user boolean true
# Учетная запись и пароль пользователя
 d-i passwd/user-fullname string {{ ansible_ssh_user }}
 d-i passwd/username string {{ ansible_ssh_user }}
 d-i passwd/user-password password {{ ansible_ssh_pass }}
 d-i passwd/user-password-again password {{ ansible_ssh_pass }}
# Пароль суперпользователя, любой открытым текстом
 d-i passwd/root-password password {{ pxe.root_pass }}
 d-i passwd/root-password-again password {{ pxe.root_pass }}
# По умолчанию программа установки требует, чтобы репозитории
# аутентифицировались с помощью известного ключа gpg.
# Этот параметр выключает данную аутентификацию.
# Предупреждение: это небезопасно, рекомендуется не делать этого.
 d-i debian-installer/allow_unauthenticated string true

# Выбор ПО для установки
 tasksel tasksel/first multiselect Base, Fly, Internet, Multimedia, Office
 tasksel tasksel/astra-feat-setup multiselect

# Отдельные дополнительные пакеты для установки
d-i pkgsel/include string openssh-server

astra-additional-setup astra-additional-setup/additional-settings multiselect

d-i astra-additional-setup/additional-settings	multiselect
astra-additional-setup astra-additional-setup/automatic-network-disable multiselect
d-i astra-additional-setup/automatic-network-disable multiselect
d-i desktop-tablet-mode-switch/tablet-mode multiselect
# Выбор установки защищености ОС
 d-i astra-additional-setup/os-check select Maximum security level Smolensk
# Выбор параметров ОС
 d-i astra-additional-setup/additional-settings-smolensk multiselect Enable Mandatory Integrity Control, Enable Mandatory Access Control, Disable ptrace capability
tripwire tripwire/use-localkey boolean false
tripwire tripwire/use-sitekey boolean false
tripwire tripwire/installed note ok
portsentry portsentry/warn_no_block note ok
astra-license astra-license/license boolean true
krb5-config krb5-config/kerberos_servers string
libnss-ldapd libnss-ldapd/ldap-base string
libnss-ldapd libnss-ldapd/ldap-uris string
libnss-ldapd libnss-ldapd/nsswitch multiselect services
ald-client ald-client/make_config boolean false
ald-client ald-client/manual_configure false
astra-feat-setup astra-feat-setup/feat multiselect kiosk mode false
astra-feat-setup astra-feat-setup/feat multiselect Служба ALD false
d-i console-cyrillic/switch select "Клавиша Menu"
d-i console-cyrillic/toggle select Control+Shift
d-i samba-common/dhcp boolean false
d-i samba-common/workgroup string testgroup1
# Не отсылать отчёт об установленных пакетах
popularity-contest popularity-contest/participate boolean false
# grub должен устанавливаться в MBR, если на машине не найдено другой операционной системы.
d-i grub-installer/only_debian boolean true
# Это заставляет grub-installer устанавливать в MBR, даже если на машине есть другая ОС
d-i grub-installer/with_other_os boolean true
# Пароль загрузчика grub
d-i grub-installer/password password {{ pxe.grub_pass }}
d-i grub-installer/password-again password {{ pxe.grub_pass }}
grub-installer grub-installer/password-mismatch error
# Не показывать последнее сообщение о том, что установка завершена.
d-i finish-install/reboot_in_progress note
d-i finish-install/exit/poweroff boolean true
# Эта настройка заставляет программу установки не выдвигать лоток CD при перезагрузке, что иногда полезно.
#d-i cdrom-detect/eject boolean false
# Остановить систему после завершения установки, а не перегружаться в установленную систему.
#d-i debian-installer/exit/halt boolean true
# Эта настройка позволяет выключить питание машины, а не просто остановить её
#d-i debian-installer/exit/poweroff boolean true
# Эта команда выполняется перед окончанием установки
d-i preseed/late_command string   \
  in-target systemctl enable ssh; \
  echo -e "" >> /target/etc/network/interfaces; \
  echo -e "auto eth0" >> /target/etc/network/interfaces; \
  echo -e "iface eth0 inet static" >> /target/etc/network/interfaces; \
  echo -e "  address 127.127.127.127" >> /target/etc/network/interfaces; \
  echo -e "  netmask {{ net.mask }}" >> /target/etc/network/interfaces;

# UEFI LVM разметка диска 1.2 TB
d-i partman-auto/disk string /dev/sda
d-i partman-auto/method string lvm
d-i partman-lvm/device_remove_lvm boolean true
d-i partman-lvm/confirm boolean true
d-i partman-lvm/confirm_nooverwrite boolean true
d-i partman-auto-lvm/guided_size string max
d-i partman-auto/expert_recipe string \
  mypartitioning :: \
       537  1    537 fat32      $primary{ } method{ efi } format{ } . \
      1074  2   1074 ext2       $primary{ } $bootable{ } method{ format } format{ } use_filesystem{ } filesystem{ ext2 } label{ boot } mountpoint{ /boot } . \
    400000  3 800000 ext4       $primary{ } method{ lvm } device{ /dev/sda3 } vg_name{ vg00 } . \
         1  4     -1 free       $primary{ } method{ lvm } device{ /dev/sda4 } vg_name{ vg01 } . \
    100000  5 200000 ext4       $lvmok{ } in_vg{ vg00 } lv_name{ opt }  method{ format } format{ } use_filesystem{ } filesystem{ ext4 } label{ opt }  mountpoint{ /opt } . \
    100000  6 100000 ext4       $lvmok{ } in_vg{ vg00 } lv_name{ log }  method{ format } format{ } use_filesystem{ } filesystem{ ext4 } label{ log }  mountpoint{ /var/log } . \
       50%  7   100% linux-swap $lvmok{ } in_vg{ vg00 } lv_name{ swap } method{ swap }   format{ } . \
    100000  8     -1 ext4       $lvmok{ } in_vg{ vg00 } lv_name{ root } method{ format } format{ } use_filesystem{ } filesystem{ ext4 } label{ root } mountpoint{ / } . \

d-i partman-lvm/confirm_nooverwrite boolean true
d-i partman-lvm/confirm boolean true
d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/choose_partition select Finish
d-i partman/confirm_nooverwrite boolean true
d-i partman/confirm boolean true

# Принудительная установка загрузчика UEFI
d-i partman-efi/non_efi_system boolean true